var content={general:{pt:{wavePanel:"Fonte Sonora",envelopePanel:"Amplitude e Pitch",filterPanel:"Filtro",fxPanel:"Efeitos",exportPanel:"Saída",disabledWarning:"Desabilitado pelo painel Saída"},en:{wavePanel:"Choose Sample",envelopePanel:"Amplitude and Pitch",filterPanel:"Filter",fxPanel:"Effects",exportPanel:"Output",disabledWarning:"Disabled by the Output Panel"}},fileHeader:{pt:{title:"Som Escolhido",hint:'Aperte "P" para Preview'},en:{title:"Selected Sample",hint:'Press "P" to Preview'}},wavePanel:{pt:{title:"Fonte Sonora",subtitle:"Escolha um som na Biblioteca para servir de base",loading:"Por Favor, aguarde. Carregando Som.",library:"Biblioteca",samplesList:"Lista de Sons",offsetTip:"Clique na onda sonora para escolher um ponto inicial de playback",categories:{animals:"animais",cartoon:"cartoon",explosions:"explosões",foley:"foley",household:"caseiros",impacts:"impactos",machinery:"maquinário",mayhem:"destruição",nature:"natureza",organic:"orgânicos",people:"pessoas",retro:"retrô",synth:"synth",vehicles:"veículos",supermario:"super mario",turma:"turma"}},en:{title:"Choose Sample",subtitle:"Choose a a base sound sample from the Library",loading:"Loading sound file. Please wait.",library:"Library",samplesList:"Samples List",offsetTip:"Click on the waveform to choose a playback starting point",categories:{animals:"animals",cartoon:"cartoon",explosions:"explosions",foley:"foley",household:"household",impacts:"impacts",machinery:"machinery",mayhem:"mayhem",nature:"nature",organic:"organic",people:"people",retro:"retro",synth:"synth",vehicles:"vehicles"}}},envelopePanel:{pt:{title:"(b)Amplitude(/b) e (b)Pitch(/b)",subtitle:"Altere o volume e a tonalidade do som",ampEnvelope:"Amp Envelope",ampEnvelopeDescription:"Modele o volume ao longo do tempo",ampOSC:"Oscilar Volume",ampOSCDescription:"Sacuda esse volume!",pitch:"Pitch",pitchDescription:"Altere a tonalidade de seu som.",pitchOSC:"Oscilar Pitch",pitchOSCDescription:"Sacuda o pitch!",attack:"Ataque/Fade In",release:"Repouso/Fade Out",amount:"Quantidade",depth:"Força",speed:"Velocidade"},en:{title:"(b)Amplitude(/b) & (b)Pitch(/b)",subtitle:"Fiddle with the sound sample's volume and pitch",ampEnvelope:"Amp Envelope",ampEnvelopeDescription:"Shape volume through time",ampOSC:"Volume Shake",ampOSCDescription:"Shake that volume!",pitch:"Pitch",pitchDescription:"Go chipmunk or ape on your sound!",pitchOSC:"Pitch Shake",pitchOSCDescription:"Shake the pitch!",attack:"Attack/Fade In",release:"Release/Fade Out",amount:"Amount",depth:"Depth",speed:"Speed"}},filterPanel:{pt:{title:"Filtro",subtitle:"Refine o som, filtrando as frequências altas ou baixas",filterType:"Tipo de Filtro",filterTypeDescription:"Escolha as frequências a filtrar",highpass:["Passa Alta (HP)","Filtra as baixas frequências"],lowpass:["Passa Baixa (LP)","Filtra as altas frequências"],none:"Nenhum",cutoff:"Frequência de Corte",oscillateFilter:"Oscilar Filtro",oscillateFilterDescription:"Sacuda seu filtro!",disabledWarning:"Por favor, escolha um tipo de filtro antes.",speed:"Velocidade",depth:"Força"},en:{title:"Filter",subtitle:"Sculpt your sample by filtering high or low frequencies",filterType:"Filter Type",filterTypeDescription:"Choose the frequencies to filter",highpass:["High Pass (HP)","Filters low frequencies"],lowpass:["Low Pass (LP)","Filters high frequencies"],none:"None",cutoff:"Cutoff Frequency",oscillateFilter:"Filter Shake",oscillateFilterDescription:"Shake that filter!",disabledWarning:"Please select a filter type first.",speed:"Speed",depth:"Depth"}},fxPanel:{pt:{title:"Efeitos",subtitle:"Experimente com seu som utilizando efeitos DSP!",none:["Nenhum","Nenhum efeito selecionado"],reverb:["Reverb","Simula a reverberação do som em ambientes fechados"],delay:["Delay","Toca o som original e com atraso, gerando um efeito de eco"],distortion:["Distortion","Distorce som de forma ruidosa, dando um caráter agressivo ao timbre"],flanger:["Flanger","Filtra/modula frequências ao longo do tempo, de forma alienígena."],ringmodulator:["Ring Modulator","Modula o som a partir de dois sinais, com resultados bizarros!"],params:{time:"Tempo",decay:"Decaimento (Decay)",distortion:"Distorção",mix:"Mix",feedback:"Feedback",gain:"Ganho",speed:"Velocidade",depth:"Profundidade"}},en:{title:"Effects",subtitle:"Experiment with and spice up your sound sample by utilizing DSP Effects!",none:["None","No Effect Selected"],reverb:["Reverb","Simulates the reverberation of indoors locations."],delay:["Delay","The sample is replayed multiple times, creating an echo chamber."],distortion:["Distortion","The sample is harshly distorted, providing an agressive character."],flanger:["Flanger","Frequencies are filtered/modulated over time, in alien fashion."],ringmodulator:["Ring Modulator","Sample is modulated by two signals, with crazy results!"],params:{time:"Time",decay:"Decay",distortion:"Distortion",mix:"Mix",feedback:"Feedback",gain:"Gain",speed:"Speed",depth:"Depth"}}},exportPanel:{pt:{title:"Saída",subtitle:"Ajuste seus parâmetros, exporte o resultado final em formato WAV, e faça o download",exportButton:"Exportar WAV",removeButton:"Remover Arquivo",filesTitle:"Arquivos Exportados",envelopeStrip:"Amplitude & Pitch",filterStrip:"Filtro",fxStrip:"Efeitos",volumeStrip:"Volume",exportStrip:"Exportar",toggleOn:"On",toggleOff:"Off",downloadText:"Baixar Arquivo",exportPlaceholder:"Nenhum arquivo foi exportado. Aperte em 'Exportar WAV' quando terminar de trabalhar em seu efeito sonoro!",modal:{title:"Exportando",message:"Exportando arquivo WAV. Só um segundinho!"}},en:{title:"Output",subtitle:"Adjust your settings, export the final result to a WAV file, and download",exportButton:"Export WAV",removeButton:"Remove File",filesTitle:"Exported Files",envelopeStrip:"Amplitude & Pitch",filterStrip:"Filter",fxStrip:"Effects",volumeStrip:"Volume",exportStrip:"Export",toggleOn:"On",toggleOff:"Off",downloadText:"Download File",exportPlaceholder:"No exported files. Press 'Export WAV' when you are done working on your sound effect!",modal:{title:"Exporting",message:"Exporting WAV File. Just a sec!"}}},credits:{pt:{title:"Credits",description:"O Blendwave é um projeto de uma pessoa, mas sua existência não seria possível sem o trabalho destas pessoas incríveis:",samples:{title:"Samples de Áudio",list:[{name:"Archive.org",link:"archive.org",description:"Múltiplas samples CC0"},{name:"Atom Splitter",link:!1,description:"Games and 8 Bit Kit, Bird Calls"},{name:"Freesound",link:"https://freesound.org/",description:"Sons dos usuários: lolamadeus, klankbeeld, newagesoup, eflextheseounddesigner, eardeer, not-danny2462, railgun, toiletrolltube, cribbler, nwlandi, audionautics, slave2thelight, nebulousflynn, productionnow, richerlandtv, slanesh, cgeffex, lonemonk, ali-k, markedit, enric592, kiodo, madmini, toam, laribum, zaem, cliftonmcarlson, thiagoriedel, willybilly1984, inspectorj, dycmaster, euphrosyyn."},{name:"Kenney",link:"http://www.kenney.nl",description:"Free Audio Assets"},{name:"Murilo Romera",link:"http://muriloromera.com/",description:"Donator of multiple sounds"},{name:"Open Game Art",link:"https://opengameart.org",description:"Diversas samples CC0"},{name:"Soundbible.com",link:"http://www.soundbible.com",description:"Recordings by Daniel Simion"},{name:"Soundimage.org",link:"http://soundimage.org/",description:"Sound Effects by Eric Matyas"},{name:"Volterock & undocument",link:"http://www.volterock.com/",description:"Vocal Hazard Pack vol.I and II"},{name:"Wikimedia",link:"https://commons.wikimedia.org",description:"Audio files of animal sounds from the United States Fish and Wildlife Service"}]},tech:{title:"Tecnologia",list:[{name:"Anime.js",link:"http://animejs.com/",description:"Utilizada em algumas animações de UI."},{name:"Pizzicato.js",link:"https://github.com/alemangui/pizzicato",description:"A engine de áudio do Blendwave. Uma ótima biblioteca para trabalhar com samples na Web Audio API."},{name:"RecorderJS",link:"https://github.com/mattdiamond/Recorderjs",description:"Utilizada para gravar a saída de som do app e consodilá-la num arquivo WAV."},{name:"Vue JS",link:"https://vuejs.org",description:"É onde a maior parte da lógica do app foi escrita. Eu adoro trabalhar com essa lib!"},{name:"Wavesurfer",link:"https://wavesurfer-js.org/",description:"As visualizações dos arquivos de som são geradas com esta biblioteca."},{name:"Zepto",link:"http://zeptojs.com/",description:"Porque as vezes tudo que você quer é um açúcar sintático estilo jQuery!"}]}},en:{title:"Credits",description:"Blendwave is a one-man endeavour, but its existence wouldn't be possible without the work and/or help from these amazing people:",samples:{title:"Audio Samples",list:[{name:"Archive.org",link:"http://archive.org",description:"Multiple CC0 samples"},{name:"Atom Splitter",link:!1,description:"Games and 8 Bit Kit, Bird Calls"},{name:"Freesound",link:"https://freesound.org/",description:"Sounds from users: lolamadeus, klankbeeld, newagesoup, eflextheseounddesigner, eardeer, not-danny2462, railgun, toiletrolltube, cribbler, nwlandi, audionautics, slave2thelight, nebulousflynn, productionnow, richerlandtv, slanesh, cgeffex, lonemonk, ali-k, markedit, enric592, kiodo, madmini, toam, laribum, zaem, cliftonmcarlson, thiagoriedel, willybilly1984, inspectorj, dycmaster, euphrosyyn."},{name:"Kenney",link:"http://www.kenney.nl",description:"Free Audio Assets"},{name:"Murilo Romera",link:"http://muriloromera.com/",description:"Donator of multiple sounds"},{name:"Open Game Art",link:"https://opengameart.org",description:"Too many CC0 Sound Effects to mention!"},{name:"Soundbible.com",link:"www.soundbible.com",description:"Recordings by Daniel Simion"},{name:"Soundimage.org",link:"http://soundimage.org/",description:"Sound Effects by Eric Matyas"},{name:"Volterock & undocument",link:"http://www.volterock.com/",description:"Vocal Hazard Pack vol.I and II"},{name:"Wikimedia",link:"https://commons.wikimedia.org",description:"Audio files of animal sounds from the United States Fish and Wildlife Service"}]},tech:{title:"Technology",list:[{name:"Anime.js",link:"http://animejs.com/",description:"Used on some UI animations."},{name:"Pizzicato.js",link:"https://github.com/alemangui/pizzicato",description:"Blendwave's audio engine. A great Web Audio API library to work with audio samples."},{name:"RecorderJS",link:"https://github.com/mattdiamond/Recorderjs",description:"Used to record the app's output and bounce it to a WAV file."},{name:"Vue JS",link:"https://vuejs.org",description:"Is where most of the App logic was written. I like it very much!"},{name:"Wavesurfer",link:"https://wavesurfer-js.org/",description:"The audio file visualizations are generated with this lib."},{name:"Zepto",link:"http://zeptojs.com/",description:"Because sometimes you just need some jQueryish syntatic sugar"}]}}}},util={logValue:function(){var e=0;this.start=function(t){e=window.setInterval((function(){console.log(t)}),100)},this.stop=function(){window.clearInterval(e)}},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},ampEnvelope={connected:!1,attack:{value:0,applyEnvelope:function(){this.node.gain.cancelScheduledValues(Pz.context.currentTime),this.node.gain.setValueAtTime(0,Pz.context.currentTime),this.node.gain.linearRampToValueAtTime(1,Pz.context.currentTime+this.value)}},release:{value:0,prePlayUpdate:function(){this.node.gain.cancelScheduledValues(Pz.context.currentTime),this.node.gain.setValueAtTime(1,Pz.context.currentTime)},applyEnvelope:function(){var e,t=patch.sound.sourceNode.buffer.duration-bw.$refs.wavePanel.offset;bw.$refs.envelopePanel.pitch.active?e=t*Math.pow(1.059,-bw.$refs.envelopePanel.pitch.params.amount.value):e=t;this.value>e&&(this.value=e);var a=Pz.context.currentTime,i=parseFloat(this.value/3).toFixed(2);this.node.gain.setTargetAtTime(0,a,i)}},create:function(){this.attack.node=Pizzicato.context.createGain(),this.attack.node.gain.value=1,this.release.node=Pizzicato.context.createGain(),this.release.node.gain.value=1},connect:function(e,t){nodeHistory.oldFade=patch.sound.fadeNode,nodeHistory.oldFirstGain=e,e.disconnect(t),e.connect(this.attack.node),this.attack.node.connect(this.release.node),this.release.node.connect(t),ampEnvelope.connected=!0},disconnect:function(){this.connected&&(nodeHistory.oldFirstGain.disconnect(this.attack.node),this.release.node.disconnect(nodeHistory.oldFade))},prePlayUpdate:function(){bw.$refs.envelopePanel.amp_envelope.params.attack.value!=bw.$refs.envelopePanel.amp_envelope.params.attack.default&&this.attack.applyEnvelope(),this.release.prePlayUpdate(),ampEnvelope.disconnect()}},nodeHistory={oldFade:null,oldMasterVolume:null,oldFirstGain:null},patch={sound:{},prePlayUpdate:function(){bw.$refs.envelopePanel.prePlayUpdate(),ampEnvelope.prePlayUpdate(),bw.$refs.filterPanel.prePlayUpdate(),bw.$refs.fxPanel.prePlayUpdate(),bw.$refs.exportPanel.prePlayUpdate()},postPlayUpdate:function(){bw.$refs.envelopePanel.postPlayUpdate(),bw.$refs.filterPanel.postPlayUpdate()},play:function(){this.sound.stop(),this.prePlayUpdate(),this.sound.play(0,bw.$refs.wavePanel.offset),this.postPlayUpdate()},stop:function(){bw.$refs.envelopePanel.amp_envelope.active&&ampEnvelope.release.applyEnvelope()},analyser:{create:function(){this.node=Pizzicato.context.createAnalyser(),this.node.fftSize=32,Pizzicato.masterGainNode.connect(this.node)}},logNodes:function(){for(node in console.log("Fade: "+patch.sound.fadeNode.__resource_id__),console.log("Attack: "+ampEnvelope.attack.node.__resource_id__),console.log("Release: "+ampEnvelope.release.node.__resource_id__),console.log("Master Volume: "+patch.sound.masterVolume.__resource_id__),nodeHistory)"log"!=node&&null!=nodeHistory[node]&&console.log(node+" "+nodeHistory[node].__resource_id__)},ps:function(){this.sound.play(),window.setTimeout((function(){patch.sound.stop()}),1e3)}};Vue.component("fileheader",{template:"#fileHeader",data:function(){return{content:content.fileHeader,active:!1}},methods:{play:function(){this.active=!0,bw.$refs.wavePanel.loading||patch.play()},stop:function(){this.active=!1,patch.stop()}},computed:{fileName:function(){return this.$root.file}}}),Vue.component("modaloverlay",{template:"#modalOverlay",props:["modalcontent","active","type"],data:function(){return{}},methods:{close:function(e){this.$emit("close")}},updated:function(){this.active?$("html").addClass("modalOn"):$("html").removeClass("modalOn")}}),Vue.component("wavepanel",{props:["active"],template:"#wavePanel",data:function(){return{content:content.wavePanel,loading:!1,wavesurfer:null,category:"animals",activeElement:null,offset:0}},methods:{changeFile:function(e){var t=$(e.target).data("path");this.$root.soundOptions.path=t;var a=t.split("/"),i=a[a.length-1].split(".");this.$root.file=i[0],this.loading=!0,null!=this.activeElement&&$(this.activeElement).removeClass("active"),$(e.target).addClass("active"),this.activeElement=e.target,this.$root.resetData(),patch.sound.stop(),patch.sound.disconnect(),patch.sound=new Pizzicato.Sound({source:"file",options:this.$root.soundOptions},(function(){bw.$refs.wavePanel.loading=!1,bw.$refs.fileHeader.play(),patch.sound.sourceNode.onended=function(){bw.$refs.fileHeader.stop()}})),this.wavesurfer.load(this.$root.soundOptions.path)},changeCategory:function(e){this.category=e.target.id,$(".sampleCategories li").removeClass("active"),$(e.target).addClass("active")},resetDefaults:function(){this.offset=0}},mounted:function(){var e=$(".fileList a"),t=e[Math.floor(Math.random()*e.length)];this.activeElement=t;var a=$(t).data("path").split("/"),i=a[a.length-3],o=a[a.length-2],n=a[a.length-1],s=t.innerHTML;this.category=o,this.$root.file=s,this.$root.soundOptions.path=i+"/"+o+"/"+n,$(".sampleCategories #"+o).addClass("active"),$(t).addClass("active"),this.wavesurfer=WaveSurfer.create({container:"#wavePreview",waveColor:"#d0d4de",progressColor:"#4b4f58",cursorColor:"#fff",cursorWidth:3,height:80});var l=this;this.wavesurfer.on("seek",(function(){time=l.wavesurfer.getCurrentTime().toFixed(2),l.offset=parseFloat(time)})),this.wavesurfer.load(this.$root.soundOptions.path)}}),Vue.component("envelopepanel",{props:["active"],template:"#envelopePanel",data:function(){return{content:content.envelopePanel,amp_envelope:{name:"Amp Envelope",active:!1,params:{attack:{name:"attack",default:0,value:0,min:0,max:5,step:.1},release:{name:"release",default:1,value:.5,min:.1,max:8,step:.01}}},amp_osc:{name:"Oscilar Volume",active:!1,pizEffect:{},params:{speed:{name:"speed",default:5,value:5,min:0,max:20,step:.1},depth:{name:"depth",default:1,value:1,min:0,max:1,step:.01}}},pitch:{name:"Pitch",active:!1,params:{amount:{name:"amount",default:0,value:0,min:-24,max:24,step:1}}},pitch_osc:{name:"Oscilar Pitch",active:!1,params:{speed:{name:"speed",default:5,value:5,min:0,max:10,step:.1}}}}},methods:{prePlayUpdate:function(){this.amp_envelope.active&&(ampEnvelope.attack.value=parseFloat(this.amp_envelope.params.attack.value)+.04,ampEnvelope.release.value=parseFloat(this.amp_envelope.params.release.value)),this.amp_osc.pizEffect.speed=parseFloat(this.amp_osc.params.speed.value),this.amp_osc.pizEffect.depth=parseFloat(this.amp_osc.params.depth.value)},postPlayUpdate:function(){this.setPitchOSC(),this.pitch.active&&(patch.sound.sourceNode.detune.value=100*this.pitch.params.amount.value)},setAmpEnvelope:function(){this.amp_envelope.active=!this.amp_envelope.active;var e=patch.sound.getRawSourceNode();this.amp_envelope.params.release.max=3*e.buffer.duration},setAmpOSC:function(){this.amp_osc.active=!this.amp_osc.active,this.amp_osc.active?patch.sound.addEffect(this.amp_osc.pizEffect):patch.sound.removeEffect(this.amp_osc.pizEffect)},setPitchOSC:function(){if(this.pitch_osc.active){var e=Pizzicato.context.createOscillator();e.frequency.value=this.pitch_osc.params.speed.value,e.connect(patch.sound.sourceNode.playbackRate),e.start()}},resetDefaults:function(){for(item in this._data)for(param in this._data[item].params)this._data[item].params[param].value=this._data[item].params[param].default;this.amp_envelope.active=!1,this.amp_osc.active=!1,this.pitch.active=!1,this.pitch_osc.active=!1}},computed:{getSnapshot:function(){return{amp_envelope:this.amp_envelope.active,amp_osc:this.amp_osc.active,pitch:this.pitch.active,pitch_osc:this.pitch_osc.active}}},mounted:function(){this.amp_osc.pizEffect=new Pizzicato.Effects.Tremolo({mix:1,speed:parseFloat(this.amp_osc.params.speed.value),depth:parseFloat(this.amp_osc.params.depth.value)});var e=$("#envelope h3").html().split("(b)").join("<b>").split("(/b)").join("</b>");$("#envelope h3").html(e)}}),Vue.component("filterpanel",{props:["active"],template:"#filterPanel",data:function(){return{content:content.filterPanel,selected:"none",applied:null,filter:{lowpass:{pizEffect:{},params:{cutoff:{default:300,value:300,min:20,max:2e4,step:100}}},highpass:{pizEffect:{},params:{cutoff:{default:1e3,value:1e3,min:100,max:22e3,step:100}}}},osc:{active:!1,oscNode:null,gainNode:Pizzicato.context.createGain(),params:{speed:{default:5,value:5,min:0,max:20,step:.1},amount:{default:1,value:1,min:0,max:5,step:1}}}}},methods:{set:function(){"none"!=this.selected?(null!=this.applied&&patch.sound.removeEffect(this.applied),patch.sound.addEffect(this.filter[this.selected].pizEffect),this.applied=this.filter[this.selected].pizEffect):(patch.sound.removeEffect(this.applied),this.applied=null)},prePlayUpdate:function(){"none"!=this.selected&&(this.filter[this.selected].pizEffect.frequency=this.filter[this.selected].params.cutoff.value)},postPlayUpdate:function(){this.setOSC()},setOSC:function(){"none"!=this.selected&&(this.osc.oscNode&&this.osc.oscNode.disconnect(),this.osc.oscNode=Pizzicato.context.createOscillator(),this.osc.oscNode.frequency.value=this.osc.params.speed.value,this.osc.oscNode.connect(this.osc.gainNode),this.osc.gainNode.connect(this.filter[this.selected].pizEffect.filterNode.frequency),this.osc.oscNode.start(),this.osc.active?this.osc.gainNode.gain.value=500*this.osc.params.amount.value:this.osc.gainNode.gain.value=0)},ignoreKeyboard:function(e){e.keyCode>=65&&e.keyCode<=90&&(e.returnValue=!1,e.cancel=!0)},resetDefaults:function(){this.selected="none",this.filter.lowpass.params.cutoff.value=this.filter.lowpass.params.cutoff.default,this.filter.highpass.params.cutoff.value=this.filter.highpass.params.cutoff.default,this.osc.active=!1,this.osc.params.speed.value=this.osc.params.speed.default,this.osc.params.amount.value=this.osc.params.amount.default}},computed:{getSnapshot:function(){return{applied:this.applied,osc:this.osc.active}},disabledWarning:function(){if("none"===this.selected)return this.content[this.$root.locale].disabledWarning},filterImg:function(){return"background-image: url(img/filter_"+this.selected+".png)"}},mounted:function(){this.filter.lowpass.pizEffect=new Pizzicato.Effects.LowPassFilter({frequency:this.filter.lowpass.params.cutoff.value,mix:0}),this.filter.highpass.pizEffect=new Pizzicato.Effects.HighPassFilter({frequency:this.filter.lowpass.params.cutoff.value,mix:0})}});var effects={reverb:{key:"reverb",img:"img/fx_reverb.jpg",params:[{id:"time",value:.5,min:0,max:3,step:.01},{id:"decay",value:.3,min:1,max:3,step:.01},{id:"mix",value:.5,min:0,max:1,step:.01}]},delay:{key:"delay",img:"img/fx_delay.jpg",params:[{id:"time",value:.4,min:0,max:1,step:.01},{id:"feedback",value:.6,min:0,max:1,step:.01},{id:"mix",value:.5,min:0,max:1,step:.01}]},distortion:{key:"distortion",img:"img/fx_distortion.jpg",params:[{id:"gain",value:.5,min:0,max:1,step:.01}]},flanger:{key:"flanger",img:"img/fx_flanger.jpg",params:[{id:"time",value:.5,min:0,max:1,step:.01},{id:"speed",value:.2,min:0,max:1,step:.01},{id:"depth",value:.1,min:0,max:1,step:.01},{id:"feedback",value:.1,min:0,max:1,step:.01},{id:"mix",value:1,min:0,max:1,step:.01}]},ringmodulator:{key:"ringmodulator",img:"img/fx_ringmodulator.jpg",params:[{id:"speed",value:110,min:0,max:2e3,step:1},{id:"distortion",value:1,min:.1,max:50,step:.1},{id:"mix",value:.5,min:0,max:1,step:.01}]}};Vue.component("fxpanel",{props:["active"],template:"#fxPanel",data:function(){return{content:content.fxPanel,fxSlots:{fxSlot1:{active:!1,selected:"none",pizEffect:{},fxData:{}},fxSlot2:{active:!1,selected:"none",pizEffect:{},fxData:{}}}}},methods:{toggleFX:function(e){var t=this.fxSlots[e];t.active=!t.active,t.active?document.querySelector("#"+e+" .fxControls select").removeAttribute("disabled"):document.querySelector("#"+e+" .fxControls select").setAttribute("disabled","disabled")},getParams:function(e,t){var a={};for(index in e.fxData[t].params){var i=e.fxData[t].params[index];a[i.id]=i.value}return a},setFX:function(e){var t=this.fxSlots[e],a=this.fxSlots[e].selected;if(t.pizEffect.outputNode&&(patch.sound.removeEffect(t.pizEffect),t.pizEffect={}),"none"!=a){var i=this.getParams(t,a),o="ringmodulator"===a?"RingModulator":util.capitalize(a);t.pizEffect=new Pizzicato.Effects[o](i),patch.sound.addEffect(t.pizEffect)}},resetFX:function(){for(var e in this.fxSlots){if("none"!=this.fxSlots[e].selected){var t=this.fxSlots[e].fxData[this.fxSlots[e].selected].params,a=effects[this.fxSlots[e].selected].params;for(i in t)t[i].value=a[i].value;this.fxSlots[e].selected="none",this.fxSlots[e].pizEffect={}}this.fxSlots[e].active&&this.toggleFX(e)}},prePlayUpdate:function(){for(var e in this.fxSlots)if(this.fxSlots[e].active){if("none"!=this.fxSlots[e].selected){var t=this.getParams(this.fxSlots[e],this.fxSlots[e].selected);for(var a in"ringmodulator"===this.fxSlots[e].selected&&(t.mix=t.mix/4),t)this.fxSlots[e].pizEffect[a]=t[a]}}else"Distortion"!=this.fxSlots[e].selected?this.fxSlots[e].pizEffect.mix=0:this.fxSlots[e].pizEffect.gain=.1}},computed:{getSnapshot:function(){return{fxSlot1:this.fxSlots.fxSlot1.active,fxSlot2:this.fxSlots.fxSlot2.active}}},mounted:function(){this.fxSlots.fxSlot1.fxData=JSON.parse(JSON.stringify(effects)),this.fxSlots.fxSlot2.fxData=JSON.parse(JSON.stringify(effects))}}),Vue.component("exportpanel",{props:["active"],template:"#exportPanel",data:function(){return{content:content.exportPanel,interval:null,exporting:!1,emptyList:!0,fileCounter:0,mixer:{envelopePanel:{active:!0,snapshot:{}},filterPanel:{active:!0,snapshot:{}},fxPanel:{active:!0,snapshot:{}},volume:{value:1,min:0,max:2,step:.01}}}},methods:{togglePanel:function(e){if(this.mixer[e].active=!this.mixer[e].active,bw.panels[e].disabled=!this.mixer[e].active,this.mixer[e].active){if(this.mixer[e].active)switch(e){case"envelopePanel":for(param in this.mixer[e].snapshot)bw.$refs.envelopePanel[param].active=this.mixer[e].snapshot[param];break;case"filterPanel":null!=this.mixer[e].snapshot.applied&&patch.sound.addEffect(this.mixer[e].snapshot.applied);break;case"fxPanel":for(fxSlot in this.mixer[e].snapshot)bw.$refs[e].fxSlots[fxSlot].active=this.mixer[e].snapshot[fxSlot]}}else switch(this.mixer[e].snapshot=bw.$refs[e].getSnapshot,e){case"envelopePanel":for(param in this.mixer[e].snapshot)bw.$refs[e][param].active=!1;break;case"filterPanel":null!=this.mixer[e].snapshot.applied&&patch.sound.removeEffect(this.mixer[e].snapshot.applied);break;case"fxPanel":for(fxSlot in this.mixer[e].snapshot)bw.$refs[e].fxSlots[fxSlot].active=!1}},exportFile:function(){var e=this;e.exporting=!0;var t=new Recorder(Pizzicato.masterGainNode);function a(){var a=0,o=1,n=0,s=new Uint8Array(4),l=bw.$refs.fxPanel.fxSlots,r=[0];for(slot in l)if("delay"==l[slot].selected){for(i in l[slot].fxData.delay.params)"time"===l[slot].fxData.delay.params[i].id&&r.push(l[slot].fxData.delay.params[i].value);var c=Math.max.apply(null,r);o=60*c}function p(){clearInterval(this.interval),t&&t.exportWAV((function(t){e.addFile(t)})),e.exporting=!1}this.interval=setInterval((function(){patch.analyser.node.minDecibels=-80,patch.analyser.node.getByteFrequencyData(s),s[1]<1?a>o?p():a++:s[2]<1&&s[1]<50&&n>200&&p(),n++}),30)}patch.sound.stop(),t.record(),patch.play(),bw.$refs.envelopePanel.amp_envelope.active?(window.setTimeout((function(){patch.stop()}),20),patch.sound.sourceNode.onended=function(){a()}):a()},addFile:function(e){self=this;var t=$("#recordingslist li"),a=bw.file+"_"+t.length+".wav",i=URL.createObjectURL(e);WaveSurfer.create({container:"#dlTemplate #fileWaveform",waveColor:"#d0d4de",progressColor:"#4b4f58",cursorColor:"#fff",cursorWidth:0,height:56}).load(i);var o="link"+this.fileCounter,n=$("#dlTemplate").clone().attr("id",o).appendTo("#recordingslist");wsDestination=n.find("#fileWaveform"),wsDestination.children().remove(),$("#dlTemplate #fileWaveform").children().prependTo(wsDestination),n.find("audio").attr("src",i),dwButton=n.find('[data-id="dwButton"]')[0],dwButton.href=i,dwButton.download=a,n.find("h5").html(a),n.find('[data-id="delButton"]').on("click",(function(e){self.removeFile(e)})),patch.sound.stop(),this.emptyList=!1,this.fileCounter++},createPreview:function(){},removeFile:function(e){var t=this;fileNode=e.target.parentElement.parentElement;anime({targets:fileNode,height:0,paddingBottom:0,opacity:0,duration:500,easing:"easeOutSine",complete:function(){$(fileNode).remove(),$("#recordingslist").children("li").length<1&&(t.emptyList=!0)}})},prePlayUpdate:function(){Pizzicato.masterGainNode.gain.value=this.mixer.volume.value}},computed:{masterVolume:function(){return parseInt(50*this.mixer.volume.value)},toggleButton:function(e){return e}}});var bw=new Vue({el:"#blendwave",data:{panels:{wavePanel:{active:!1},envelopePanel:{active:!1,disabled:!1},filterPanel:{active:!1,disabled:!1},fxPanel:{active:!1,disabled:!1},exportPanel:{active:!1}},file:"",locale:bwLocale,content:content.general,mainClass:"",loaded:!1,soundOptions:{path:"",attack:.04,volume:1,loop:!1},credits:{visible:!1,content:content.credits}},methods:{activatePanel:function(e){if(!this.panels[e].disabled){for(p in this.panels)this.panels[p].active=!1;this.panels[e].active=!0,this.mainClass=e,this.gaSend("screenview",{screenName:e})}},resetData:function(){bw.$refs.wavePanel.resetDefaults(),bw.$refs.fxPanel.resetFX(),bw.$refs.envelopePanel.resetDefaults(),bw.$refs.filterPanel.resetDefaults()},initializePatch:function(){patch.sound=new Pizzicato.Sound({source:"file",options:this.soundOptions},(function(){patch.analyser.create(),ampEnvelope.create()}))},closeModal:function(e){this.credits.visible=!1},hidePreloader:function(){pl=document.getElementById("preLoader"),pl.style.display="none"},gaSend:function(e,t){window.ga&&("screenview"===e?ga("send",e,t):"event"===e&&(t.hitType=e,ga("send",t)))}},mounted:function(){this.initializePatch(),$("body").on("keydown",(function(e){80!=e.keyCode||e.repeat||(analytics?bw.$refs.wavePanel.loading||(bw.$refs.fileHeader.play(),bw.gaSend("event",{eventCategory:"Keyboard",eventAction:"Preview Audio"})):bw.$refs.wavePanel.loading||bw.$refs.fileHeader.play())})),$("body").on("keyup",(function(e){80==e.keyCode&&bw.$refs.fileHeader.stop()})),this.activatePanel("wavePanel"),this.loaded=!0,this.hidePreloader()}});