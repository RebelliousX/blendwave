var content={general:{pt:{wavePanel:"Fonte Sonora",envelopePanel:"Amplitude e Pitch",filterPanel:"Filtro",fxPanel:"Efeitos",exportPanel:"Saída",disabledWarning:"Desabilitado pelo painel Saída"},en:{wavePanel:"Choose Sample",envelopePanel:"Amplitude and Pitch",filterPanel:"Filter",fxPanel:"Effects",exportPanel:"Output",disabledWarning:"Disabled by the Output Panel"}},fileHeader:{pt:{title:"Som Escolhido",hint:'Aperte "P" para Preview'},en:{title:"Selected Sample",hint:'Press "P" to Preview'}},wavePanel:{pt:{title:"Fonte Sonora",subtitle:"Escolha um som na Biblioteca para servir de base",loading:"Por Favor, aguarde. Carregando Som.",library:"Biblioteca",samplesList:"Lista de Sons",offsetTip:"Clique na onda sonora para escolher um ponto inicial de playback"},en:{title:"Choose Sample",subtitle:"Choose a a base sound sample from the Library",loading:"Loading sound file. Please wait.",library:"Library",samplesList:"Samples List",offsetTip:"Click on the waveform to choose a playback starting point"}},envelopePanel:{pt:{title:"(b)Amplitude(/b) e (b)Pitch(/b)",subtitle:"Altere o volume e a tonalidade do som",ampEnvelope:"Amp Envelope",ampEnvelopeDescription:"Modele o volume ao longo do tempo",ampOSC:"Oscilar Volume",ampOSCDescription:"Sacuda esse volume!",pitch:"Pitch",pitchDescription:"Altere a tonalidade de seu som.",pitchOSC:"Oscilar Pitch",pitchOSCDescription:"Sacuda o pitch!",attack:"Ataque/Fade In",release:"Repouso/Fade Out",amount:"Quantidade",depth:"Força",speed:"Velocidade"},en:{title:"(b)Amplitude(/b) & (b)Pitch(/b)",subtitle:"Fiddle with the sound sample's volume and pitch",ampEnvelope:"Amp Envelope",ampEnvelopeDescription:"Shape volume through time",ampOSC:"Volume Shake",ampOSCDescription:"Shake that volume!",pitch:"Pitch",pitchDescription:"Go chipmunk or ape on your sound!",pitchOSC:"Pitch Shake",pitchOSCDescription:"Shake the pitch!",attack:"Attack/Fade In",release:"Release/Fade Out",amount:"Amount",depth:"Depth",speed:"Speed"}},filterPanel:{pt:{title:"Filtro",subtitle:"Refine o som, filtrando as frequências altas ou baixas",filterType:"Tipo de Filtro",filterTypeDescription:"Escolha as frequências a filtrar",highpass:["Passa Alta (HP)","Filtra as baixas frequências"],lowpass:["Passa Baixa (LP)","Filtra as altas frequências"],none:"Nenhum",cutoff:"Frequência de Corte",oscillateFilter:"Oscilar Filtro",oscillateFilterDescription:"Sacuda seu filtro!",speed:"Velocidade",depth:"Força"},en:{title:"Filter",subtitle:"Sculpt your sample by filtering high or low frequencies",filterType:"Filter Type",filterTypeDescription:"Choose the frequencies to filter",highpass:["High Pass (HP)","Filters low frequencies"],lowpass:["Low Pass (LP)","Filters high frequencies"],none:"None",cutoff:"Cutoff Frequency",oscillateFilter:"Filter Shake",oscillateFilterDescription:"Shake that filter!",speed:"Speed",depth:"Depth"}},fxPanel:{pt:{title:"Efeitos",subtitle:"Experimente com seu som utilizando efeitos DSP!",none:["Nenhum","Nenhum efeito selecionado"],reverb:["Reverb","Simula a reverberação do som em ambientes fechados"],delay:["Delay","Toca o som original e com atraso, gerando um efeito de eco"],distortion:["Distortion","Distorce som de forma ruidosa, dando um caráter agressivo ao timbre"],flanger:["Flanger","Filtra frequências ao longo do tempo, conferindo uma estética incomum ao som"],ringmodulator:["Ring Modulator","Modula o som a partir de dois sinais, resultando em um timbre metálico e alienígena"],params:{time:"Tempo",decay:"Decaimento (Decay)",distortion:"Distorção",mix:"Mix",feedback:"Feedback",gain:"Ganho",speed:"Velocidade",depth:"Profundidade"}},en:{title:"Effects",subtitle:"Experiment with and spice up your sound sample by utilizing DSP Effects!",none:["None","No Effect Selected"],reverb:["Reverb","Simulates the reverberation of indoors locations."],delay:["Delay","The sample is replayed multiple times, creating an echo chamber."],distortion:["Distortion","The sample is harshly distorted, providing an agressive character."],flanger:["Flanger","Frequencies are filtered and modulated over time, resulting in an unusual aesthetic."],ringmodulator:["Ring Modulator","The sample is modulated by two signals, resulting in an alien and metalic timbre"],params:{time:"Time",decay:"Decay",distortion:"Distortion",mix:"Mix",feedback:"Feedback",gain:"Gain",speed:"Speed",depth:"Depth"}}},exportPanel:{pt:{title:"Saída",subtitle:"Ajuste seus parâmetros, exporte o resultado final em formato WAV, e faça o download",exportButton:"Exportar WAV",filesTitle:"Arquivos Exportados",envelopeStrip:"Amplitude & Pitch",filterStrip:"Filtro",fxStrip:"Efeitos",volumeStrip:"Volume",exportStrip:"Exportar",toggleOn:"On",toggleOff:"Off",downloadText:"Baixar Arquivo",exportPlaceholder:"Nenhum arquivo foi exportado. Aperte em 'Exportar WAV' quando terminar de trabalhar em seu efeito sonoro!",modal:{title:"Exportando",message:"Exportando arquivo WAV. Só um segundinho!"}},en:{title:"Output",subtitle:"Adjust your settings, export the final result to a WAV file, and download",exportButton:"Export WAV",filesTitle:"Exported Files",envelopeStrip:"Amplitude & Pitch",filterStrip:"Filter",fxStrip:"Effects",volumeStrip:"Volume",exportStrip:"Export",toggleOn:"On",toggleOff:"Off",downloadText:"Download File",exportPlaceholder:"No exported files. Press 'Export WAV' when you are done working on your sound effect!",modal:{title:"Exporting",message:"Exporting WAV File. Just a sec!"}}},credits:{pt:{title:"Credits",description:"O Blendwave é um projeto de uma pessoa, mas sua existência não seria possível sem o trabalho destas pessoas incríveis:",samples:{title:"Samples de Áudio",list:[{name:"Archive.org",link:"archive.org",description:"Múltiplas samples CC0"},{name:"Atom Splitter",link:!1,description:"Games and 8 Bit Kit, Bird Calls"},{name:"Freesound",link:"https://freesound.org/",description:"Sons dos usuários: lolamadeus, klankbeeld, newagesoup, eflextheseounddesigner, eardeer, not-danny2462, railgun, toiletrolltube, cribbler, nwlandi, audionautics, slave2thelight, nebulousflynn, productionnow, richerlandtv, slanesh, cgeffex, lonemonk, ali-k, markedit, enric592, kiodo, madmini, toam, laribum, zaem, cliftonmcarlson, thiagoriedel, willybilly1984, inspectorj, dycmaster, euphrosyyn."},{name:"Kenney",link:"http://www.kenney.nl",description:"Free Audio Assets"},{name:"Murilo Romera",link:"http://muriloromera.com/",description:"Donator of multiple sounds"},{name:"Open Game Art",link:"https://opengameart.org",description:"Diversas samples CC0"},{name:"Soundbible.com",link:"http://www.soundbible.com",description:"Recordings by Daniel Simion"},{name:"Soundimage.org",link:"http://soundimage.org/",description:"Sound Effects by Eric Matyas"},{name:"Volterock & undocument",link:"http://www.volterock.com/",description:"Vocal Hazard Pack vol.I and II"},{name:"Wikimedia",link:"https://commons.wikimedia.org",description:"Audio files of animal sounds from the United States Fish and Wildlife Service"}]},tech:{title:"Tecnologia",list:[{name:"Anime.js",link:"http://animejs.com/",description:"Utilizada em algumas animações de UI."},{name:"Pizzicato.js",link:"https://github.com/alemangui/pizzicato",description:"A engine de áudio do Blendwave. Uma ótima biblioteca para trabalhar com samples na Web Audio API."},{name:"RecorderJS",link:"https://github.com/mattdiamond/Recorderjs",description:"Utilizada para gravar a saída de som do app e consodilá-la num arquivo WAV."},{name:"Vue JS",link:"https://vuejs.org",description:"É onde a maior parte da lógica do app foi escrita. Eu adoro trabalhar com essa lib!"},{name:"Wavesurfer",link:"https://wavesurfer-js.org/",description:"As visualizações dos arquivos de som são geradas com esta biblioteca."},{name:"Zepto",link:"http://zeptojs.com/",description:"Porque as vezes tudo que você quer é um açúcar sintático estilo jQuery!"}]}},en:{title:"Credits",description:"Blendwave is a one-man endeavour, but its existence wouldn't be possible without the work and/or help from these amazing people:",samples:{title:"Audio Samples",list:[{name:"Archive.org",link:"http://archive.org",description:"Multiple CC0 samples"},{name:"Atom Splitter",link:!1,description:"Games and 8 Bit Kit, Bird Calls"},{name:"Freesound",link:"https://freesound.org/",description:"Sounds from users: lolamadeus, klankbeeld, newagesoup, eflextheseounddesigner, eardeer, not-danny2462, railgun, toiletrolltube, cribbler, nwlandi, audionautics, slave2thelight, nebulousflynn, productionnow, richerlandtv, slanesh, cgeffex, lonemonk, ali-k, markedit, enric592, kiodo, madmini, toam, laribum, zaem, cliftonmcarlson, thiagoriedel, willybilly1984, inspectorj, dycmaster, euphrosyyn."},{name:"Kenney",link:"http://www.kenney.nl",description:"Free Audio Assets"},{name:"Murilo Romera",link:"http://muriloromera.com/",description:"Donator of multiple sounds"},{name:"Open Game Art",link:"https://opengameart.org",description:"Too many CC0 Sound Effects to mention!"},{name:"Soundbible.com",link:"www.soundbible.com",description:"Recordings by Daniel Simion"},{name:"Soundimage.org",link:"http://soundimage.org/",description:"Sound Effects by Eric Matyas"},{name:"Volterock & undocument",link:"http://www.volterock.com/",description:"Vocal Hazard Pack vol.I and II"},{name:"Wikimedia",link:"https://commons.wikimedia.org",description:"Audio files of animal sounds from the United States Fish and Wildlife Service"}]},tech:{title:"Technology",list:[{name:"Anime.js",link:"http://animejs.com/",description:"Used on some UI animations."},{name:"Pizzicato.js",link:"https://github.com/alemangui/pizzicato",description:"Blendwave's audio engine. A great Web Audio API library to work with audio samples."},{name:"RecorderJS",link:"https://github.com/mattdiamond/Recorderjs",description:"Used to record the app's output and bounce it to a WAV file."},{name:"Vue JS",link:"https://vuejs.org",description:"Is where most of the App logic was written. I like it very much!"},{name:"Wavesurfer",link:"https://wavesurfer-js.org/",description:"The audio file visualizations are generated with this lib."},{name:"Zepto",link:"http://zeptojs.com/",description:"Because sometimes you just need some jQueryish syntatic sugar"}]}}}},util={logValue:function(){var interval=0;this.start=function(v){interval=window.setInterval(function(){console.log(v)},100)},this.stop=function(){window.clearInterval(interval)}},capitalize:function(string){return string.charAt(0).toUpperCase()+string.slice(1)}},patch={sound:{},prePlayUpdate:function(){bw.$refs.envelopePanel.prePlayUpdate(),bw.$refs.filterPanel.prePlayUpdate(),bw.$refs.fxPanel.prePlayUpdate(),bw.$refs.exportPanel.prePlayUpdate()},postPlayUpdate:function(){bw.$refs.envelopePanel.postPlayUpdate(),bw.$refs.filterPanel.postPlayUpdate()},play:function(){this.sound.stop(),this.prePlayUpdate(),this.sound.play(0,bw.$refs.wavePanel.offset),this.postPlayUpdate()},stop:function(){var attackActive=bw.$refs.envelopePanel.amp_envelope.params.attack.value!=bw.$refs.envelopePanel.amp_envelope.params.attack.default;if(bw.$refs.envelopePanel.amp_envelope.active)if(attackActive){var attack=bw.$refs.envelopePanel.amp_envelope.params.attack.value;window.setTimeout(function(){patch.sound.stop()},1e3*attack)}else patch.sound.stop()},analyser:{create:function(){this.node=Pizzicato.context.createAnalyser(),this.node.fftSize=32,Pizzicato.masterGainNode.connect(this.node)}}};Vue.component("fileheader",{template:"#fileHeader",data:function(){return{content:content.fileHeader}},methods:{play:function(){patch.play()},stop:function(){patch.stop()}},computed:{fileName:function(){return this.$root.file}}}),Vue.component("modaloverlay",{template:"#modalOverlay",props:["modalcontent","active","type"],data:function(){return{}},methods:{close:function(type){this.$emit("close")}},updated:function(){this.active?$("html").addClass("modalOn"):$("html").removeClass("modalOn")}}),Vue.component("wavepanel",{props:["active"],template:"#wavePanel",data:function(){return{content:content.wavePanel,loading:!1,wavesurfer:null,category:"animals",activeElement:null,offset:0}},methods:{changeFile:function(event){this.$root.soundOptions.path=event.target.href;var fileString=event.target.href.split("/"),fileName=fileString[fileString.length-1].split(".");this.$root.file=fileName[0],this.loading=!0,null!=this.activeElement&&$(this.activeElement).removeClass("active"),$(event.target).addClass("active"),this.activeElement=event.target,this.$root.resetData(),patch.sound.stop(),patch.sound=new Pizzicato.Sound({source:"file",options:this.$root.soundOptions},function(){bw.$refs.wavePanel.loading=!1,patch.play()}),this.wavesurfer.load(this.$root.soundOptions.path)},changeCategory:function(event){this.category=event.target.id,$(".sampleCategories li").removeClass("active"),$(event.target).addClass("active")},resetDefaults:function(){this.offset=0}},mounted:function(){var files=$(".fileList a"),rndElement=files[Math.floor(Math.random()*files.length)];this.activeElement=rndElement;var path=rndElement.href.split("/"),folder=path[path.length-3],category=path[path.length-2],file=path[path.length-1],name=rndElement.innerHTML;this.category=category,this.$root.file=name,this.$root.soundOptions.path=folder+"/"+category+"/"+file,$(".sampleCategories #"+category).addClass("active"),$(rndElement).addClass("active"),this.wavesurfer=WaveSurfer.create({container:"#wavePreview",waveColor:"#d0d4de",progressColor:"#4b4f58",cursorColor:"#fff",cursorWidth:3,height:80});var self=this;this.wavesurfer.on("seek",function(){time=self.wavesurfer.getCurrentTime().toFixed(2),self.offset=parseFloat(time)}),this.wavesurfer.load(this.$root.soundOptions.path)}}),Vue.component("envelopepanel",{props:["active"],template:"#envelopePanel",data:function(){return{content:content.envelopePanel,amp_envelope:{name:"Amp Envelope",active:!1,params:{attack:{name:"attack",default:0,value:0,min:0,max:5,step:.1},release:{name:"release",default:1,value:1,min:.3,max:5,step:.1}}},amp_osc:{name:"Oscilar Volume",active:!1,pizEffect:{},params:{speed:{name:"speed",default:5,value:5,min:0,max:20,step:.1},depth:{name:"depth",default:1,value:1,min:0,max:1,step:.01}}},pitch:{name:"Pitch",active:!1,params:{amount:{name:"amount",default:0,value:0,min:-24,max:24,step:1}}},pitch_osc:{name:"Oscilar Pitch",active:!1,params:{speed:{name:"speed",default:5,value:5,min:0,max:10,step:.1}}}}},methods:{prePlayUpdate:function(){this.amp_envelope.active&&(patch.sound.attack=parseFloat(this.amp_envelope.params.attack.value)+.04,patch.sound.release=parseFloat(this.amp_envelope.params.release.value)),this.amp_osc.pizEffect.speed=parseFloat(this.amp_osc.params.speed.value),this.amp_osc.pizEffect.depth=parseFloat(this.amp_osc.params.depth.value)},postPlayUpdate:function(){this.setPitchOSC(),this.pitch.active&&(patch.sound.sourceNode.detune.value=100*this.pitch.params.amount.value)},setAmpOSC:function(){this.amp_osc.active=!this.amp_osc.active,this.amp_osc.active?patch.sound.addEffect(this.amp_osc.pizEffect):patch.sound.removeEffect(this.amp_osc.pizEffect)},setPitchOSC:function(){if(this.pitch_osc.active){var osc=Pizzicato.context.createOscillator();osc.frequency.value=this.pitch_osc.params.speed.value,osc.connect(patch.sound.sourceNode.playbackRate),osc.start()}},resetDefaults:function(){for(item in this._data)for(param in this._data[item].params)this._data[item].params[param].value=this._data[item].params[param].default;this.amp_envelope.active=!1,this.amp_osc.active=!1,this.pitch.active=!1,this.pitch_osc.active=!1}},computed:{getSnapshot:function(){return{amp_envelope:this.amp_envelope.active,amp_osc:this.amp_osc.active,pitch:this.pitch.active,pitch_osc:this.pitch_osc.active}}},mounted:function(){this.amp_osc.pizEffect=new Pizzicato.Effects.Tremolo({mix:1,speed:parseFloat(this.amp_osc.params.speed.value),depth:parseFloat(this.amp_osc.params.depth.value)});var newText=$("#envelope h3").html().split("(b)").join("<b>").split("(/b)").join("</b>");$("#envelope h3").html(newText)}}),Vue.component("filterpanel",{props:["active"],template:"#filterPanel",data:function(){return{content:content.filterPanel,selected:"none",applied:null,filter:{lowpass:{pizEffect:{},params:{cutoff:{default:300,value:300,min:20,max:2e4,step:100}}},highpass:{pizEffect:{},params:{cutoff:{default:1e3,value:1e3,min:100,max:22e3,step:100}}}},osc:{active:!1,oscNode:null,gainNode:Pizzicato.context.createGain(),params:{speed:{default:5,value:5,min:0,max:20,step:.1},amount:{default:1,value:1,min:0,max:5,step:1}}}}},methods:{set:function(){"none"!=this.selected?(null!=this.applied&&patch.sound.removeEffect(this.applied),patch.sound.addEffect(this.filter[this.selected].pizEffect),this.applied=this.filter[this.selected].pizEffect):(patch.sound.removeEffect(this.applied),this.applied=null)},prePlayUpdate:function(){"none"!=this.selected&&(this.filter[this.selected].pizEffect.frequency=this.filter[this.selected].params.cutoff.value)},postPlayUpdate:function(){this.setOSC()},setOSC:function(){"none"!=this.selected&&(this.osc.oscNode&&this.osc.oscNode.disconnect(),this.osc.oscNode=Pizzicato.context.createOscillator(),this.osc.oscNode.frequency.value=this.osc.params.speed.value,this.osc.oscNode.connect(this.osc.gainNode),this.osc.gainNode.connect(this.filter[this.selected].pizEffect.filterNode.frequency),this.osc.oscNode.start(),this.osc.active?this.osc.gainNode.gain.value=500*this.osc.params.amount.value:this.osc.gainNode.gain.value=0)},ignoreKeyboard:function(e){e.keyCode>=65&&e.keyCode<=90&&(e.returnValue=!1,e.cancel=!0)},resetDefaults:function(){this.selected="none",this.filter.lowpass.params.cutoff.value=this.filter.lowpass.params.cutoff.default,this.filter.highpass.params.cutoff.value=this.filter.highpass.params.cutoff.default,this.osc.active=!1,this.osc.params.speed.value=this.osc.params.speed.default,this.osc.params.amount.value=this.osc.params.amount.default}},computed:{getSnapshot:function(){return{applied:this.applied,osc:this.osc.active}}},mounted:function(){this.filter.lowpass.pizEffect=new Pizzicato.Effects.LowPassFilter({frequency:this.filter.lowpass.params.cutoff.value,mix:0}),this.filter.highpass.pizEffect=new Pizzicato.Effects.HighPassFilter({frequency:this.filter.lowpass.params.cutoff.value,mix:0})}});var effects={reverb:{key:"reverb",img:"img/fx_reverb.jpg",params:[{id:"time",value:.5,min:0,max:3,step:.01},{id:"decay",value:.3,min:1,max:3,step:.01},{id:"mix",value:.5,min:0,max:1,step:.01}]},delay:{key:"delay",img:"img/fx_delay.jpg",params:[{id:"time",value:.4,min:0,max:1,step:.01},{id:"feedback",value:.6,min:0,max:1,step:.01},{id:"mix",value:.5,min:0,max:1,step:.01}]},distortion:{key:"distortion",img:"img/fx_distortion.jpg",params:[{id:"gain",value:.5,min:0,max:1,step:.01}]},flanger:{key:"flanger",img:"img/fx_flanger.jpg",params:[{id:"time",value:.5,min:0,max:1,step:.01},{id:"speed",value:.2,min:0,max:1,step:.01},{id:"depth",value:.1,min:0,max:1,step:.01},{id:"feedback",value:.1,min:0,max:1,step:.01},{id:"mix",value:1,min:0,max:1,step:.01}]},ringmodulator:{key:"ringmodulator",img:"img/fx_ringmodulator.jpg",params:[{id:"speed",value:110,min:0,max:2e3,step:1},{id:"distortion",value:1,min:.1,max:50,step:.1},{id:"mix",value:.5,min:0,max:1,step:.01}]}};Vue.component("fxpanel",{props:["active"],template:"#fxPanel",data:function(){return{content:content.fxPanel,fxSlots:{fxSlot1:{active:!1,selected:"none",fxButtonText:"off",pizEffect:{},fxData:{}},fxSlot2:{active:!1,selected:"none",fxButtonText:"off",pizEffect:{},fxData:{}}}}},methods:{toggleFX:function(slot){var fxSlot=this.fxSlots[slot];fxSlot.active=!fxSlot.active,fxSlot.active?(fxSlot.fxButtonText="on",document.querySelector("#"+slot+" .fxControls select").removeAttribute("disabled")):(fxSlot.fxButtonText="off",document.querySelector("#"+slot+" .fxControls select").setAttribute("disabled","disabled"))},getParams:function(fxSlot,effect){var fxParams={};for(index in fxSlot.fxData[effect].params){var param=fxSlot.fxData[effect].params[index];fxParams[param.id]=param.value}return fxParams},setFX:function(slot){var fxSlot=this.fxSlots[slot],effect=this.fxSlots[slot].selected;if(fxSlot.pizEffect.outputNode&&(patch.sound.removeEffect(fxSlot.pizEffect),fxSlot.pizEffect={}),"none"!=effect){var fxParams=this.getParams(fxSlot,effect),pizString="ringmodulator"===effect?"RingModulator":util.capitalize(effect);fxSlot.pizEffect=new Pizzicato.Effects[pizString](fxParams),patch.sound.addEffect(fxSlot.pizEffect)}},resetFX:function(){for(var slot in this.fxSlots)if("none"!=this.fxSlots[slot].selected){var currentParams=this.fxSlots[slot].fxData[this.fxSlots[slot].selected].params,defaultParams=effects[this.fxSlots[slot].selected].params;for(i in currentParams)currentParams[i].value=defaultParams[i].value;this.toggleFX(slot),this.fxSlots[slot].selected="none",this.fxSlots[slot].pizEffect={}}},prePlayUpdate:function(){for(var slot in this.fxSlots)if(this.fxSlots[slot].active){if("none"!=this.fxSlots[slot].selected){var fxParams=this.getParams(this.fxSlots[slot],this.fxSlots[slot].selected);"ringmodulator"===this.fxSlots[slot].selected&&(fxParams.mix=fxParams.mix/4);for(var param in fxParams)this.fxSlots[slot].pizEffect[param]=fxParams[param]}}else"Distortion"!=this.fxSlots[slot].selected?this.fxSlots[slot].pizEffect.mix=0:this.fxSlots[slot].pizEffect.gain=.1}},computed:{getSnapshot:function(){return{fxSlot1:this.fxSlots.fxSlot1.active,fxSlot2:this.fxSlots.fxSlot2.active}}},mounted:function(){this.fxSlots.fxSlot1.fxData=JSON.parse(JSON.stringify(effects)),this.fxSlots.fxSlot2.fxData=JSON.parse(JSON.stringify(effects))}}),Vue.component("exportpanel",{props:["active"],template:"#exportPanel",data:function(){return{content:content.exportPanel,interval:null,exporting:!1,emptyList:!0,mixer:{envelopePanel:{active:!0,snapshot:{}},filterPanel:{active:!0,snapshot:{}},fxPanel:{active:!0,snapshot:{}},volume:{value:1,min:0,max:2,step:.01}}}},methods:{togglePanel:function(panel){if(this.mixer[panel].active=!this.mixer[panel].active,bw.panels[panel].disabled=!this.mixer[panel].active,this.mixer[panel].active){if(this.mixer[panel].active)switch(panel){case"envelopePanel":for(param in this.mixer[panel].snapshot)bw.$refs.envelopePanel[param].active=this.mixer[panel].snapshot[param];break;case"filterPanel":null!=this.mixer[panel].snapshot.applied&&patch.sound.addEffect(this.mixer[panel].snapshot.applied);break;case"fxPanel":for(fxSlot in this.mixer[panel].snapshot)bw.$refs[panel].fxSlots[fxSlot].active=this.mixer[panel].snapshot[fxSlot]}}else switch(this.mixer[panel].snapshot=bw.$refs[panel].getSnapshot,panel){case"envelopePanel":for(param in this.mixer[panel].snapshot)bw.$refs[panel][param].active=!1;break;case"filterPanel":null!=this.mixer[panel].snapshot.applied&&patch.sound.removeEffect(this.mixer[panel].snapshot.applied);break;case"fxPanel":for(fxSlot in this.mixer[panel].snapshot)bw.$refs[panel].fxSlots[fxSlot].active=!1}},exportFile:function(){function exportWhenMute(){var verifyCounter=0,verifications=1,dataArray=new Uint8Array(4),fxSlots=bw.$refs.fxPanel.fxSlots,delayTimes=[0];for(slot in fxSlots)if("delay"==fxSlots[slot].selected){for(i in fxSlots[slot].fxData.delay.params)"time"===fxSlots[slot].fxData.delay.params[i].id&&delayTimes.push(fxSlots[slot].fxData.delay.params[i].value);var longestDelay=Math.max.apply(null,delayTimes);verifications=60*longestDelay}this.interval=setInterval(function(){patch.analyser.node.getByteFrequencyData(dataArray),dataArray[0]<1&&(verifyCounter>verifications?(clearInterval(this.interval),recorder&&recorder.exportWAV(function(blob){var url=URL.createObjectURL(blob),listItems=$("#recordingslist li"),fileName=bw.file+"_"+listItems.length+".wav",fileHeader=document.createElement("h5"),mediaContainer=document.createElement("div");mediaContainer.className="mediaContainer";var li=document.createElement("li"),player=document.createElement("div");player.className="player";var au=document.createElement("audio"),hf=document.createElement("a");hf.className="bwButton";var remove=document.createElement("button");remove.className="bwButton delButton",au.controls=!0,au.src=url,hf.href=url,hf.download=fileName,hf.setAttribute("ga-on","click"),hf.setAttribute("ga-event-category","exportPanel"),hf.setAttribute("ga-event-action","download file");var text=bw.$refs.exportPanel.content[bw.locale].downloadText;fileHeader.innerHTML=fileName,li.appendChild(fileHeader),li.appendChild(mediaContainer),mediaContainer.appendChild(player),player.appendChild(au),mediaContainer.appendChild(hf),hf.innerHTML=text,mediaContainer.appendChild(remove),remove.setAttribute("ga-on","click"),remove.setAttribute("ga-event-category","exportPanel"),remove.setAttribute("ga-event-action","remove file"),remove.innerHTML="Remove File",$(remove).on("click",function(e){self.removeFile(e)}),$("#recordingslist").prepend(li)}),patch.sound.stop(),self.emptyList=!1,self.exporting=!1):verifyCounter++)},30)}var self=this;self.exporting=!0;var recorder=new Recorder(patch.sound.masterVolume);recorder.record(),patch.play(),patch.stop(),bw.$refs.envelopePanel.amp_envelope.active?patch.sound.sourceNode.onended=function(){exportWhenMute()}:exportWhenMute()},removeFile:function(e){var self=this;fileNode=e.target.parentElement.parentElement;anime({targets:fileNode,height:0,paddingBottom:0,opacity:0,duration:500,easing:"easeOutSine",complete:function(){$(fileNode).remove(),$("#recordingslist").children("li").length<1&&(self.emptyList=!0)}})},prePlayUpdate:function(){Pizzicato.masterGainNode.gain.value=this.mixer.volume.value}},computed:{masterVolume:function(){return parseInt(50*this.mixer.volume.value)},toggleButton:function(mixerStrip){return mixerStrip}}});var bw=new Vue({el:"#blendwave",data:{panels:{wavePanel:{active:!1},envelopePanel:{active:!1,disabled:!1},filterPanel:{active:!1,disabled:!1},fxPanel:{active:!1,disabled:!1},exportPanel:{active:!1}},file:"",soundOptions:{path:"samples/animals/sheep3.mp4",attack:.04,volume:1,loop:!1},locale:bwLocale,content:content.general,mainClass:"",loaded:!1,credits:{visible:!1,content:content.credits}},methods:{activatePanel:function(panel){if(!this.panels[panel].disabled){for(p in this.panels)this.panels[p].active=!1;this.panels[panel].active=!0,window.location.hash=panel,this.mainClass=panel,this.gaSend("screenview",{screenName:panel})}},resetData:function(){bw.$refs.wavePanel.resetDefaults(),bw.$refs.fxPanel.resetFX(),bw.$refs.envelopePanel.resetDefaults(),bw.$refs.filterPanel.resetDefaults()},initializePatch:function(){patch.sound=new Pizzicato.Sound({source:"file",options:this.soundOptions},function(){patch.analyser.create()})},closeModal:function(modal){this.credits.visible=!1},gaSend:function(hitType,params){window.ga&&("screenview"===hitType?ga("send",hitType,params):"event"===hitType&&(params.hitType=hitType,ga("send",params)))}},mounted:function(){this.initializePatch(),$("body").on("keydown",function(e){80!=e.keyCode||e.repeat||(ga("send","event","Keyboard","P","Preview Audio"),patch.play())}),$("body").on("keyup",function(e){80==e.keyCode&&patch.stop()}),this.activatePanel("exportPanel"),this.loaded=!0}});
